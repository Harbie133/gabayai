<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Virtual Consultation - GabayAI</title>
<link rel="stylesheet" href="navbar.css" />
<link rel="stylesheet" href="virtual_consultation_room.css" />



</head>
<body>
<!-- <CHANGE> Added responsive navbar -->
<nav class="navbar">
  <div class="navbar-container">
    <a href="homer.html" class="navbar-logo">GabayAI</a>
    <ul class="navbar-nav"> 
      <li><a href="homer.html" class="nav-link ">Dashboard</a></li>
      <li><a href="analyzer.html" class="nav-link ">Analyzer</a></li>
      <li><a href="consult.html" class="nav-link active">Consultation</a></li>
      <li><a href="profile.html" class="nav-link">Profile</a></li>
      <li>
        <button class="logout-btn" onclick="logout()">
          <i class="fas fa-sign-out-alt"></i>
          Logout
        </button>
      </li>
    </ul>

    <button class="mobile-menu-btn" onclick="toggleMobileMenu()">
      <div class="hamburger" id="hamburger">
        <span></span>
        <span></span>
        <span></span>
      </div>
    </button>
  </div>

  <div class="mobile-menu" id="mobileMenu">
    <div class="mobile-menu-items">
      <a href="homer.html" class="mobile-nav-link ">Dashboard</a>
      <a href="analyzer.html" class="mobile-nav-link ">Analyzer</a>
      <a href="consult.html" class="mobile-nav-link active">Consultation</a>
      <a href="profile.html" class="mobile-nav-link ">Profile</a>
      
      <!-- Mobile Logout Button -->
      <div class="mobile-logout">
        <button onclick="logout()">
          <i class="fas fa-sign-out-alt"></i>
          Logout
        </button>
      </div>
    </div>
  </div>
</nav>

<!-- Main Content Container -->
<div class="main-content">
  <div class="container" style="max-width: 600px;">
    <h2>Virtual Consultation Room</h2>

    <!-- Step 1: Enter Meeting Code -->
    <div class="step active" id="step1">
      <div class="consultation-icon">
        <i class="fas fa-video"></i>
      </div>

      <div class="info-box">
        <i class="fas fa-info-circle"></i>
        <div class="info-text">
          <strong>How to Join:</strong> Enter the meeting code provided by your doctor to join the video consultation session.
        </div>
      </div>

      <div class="form-section">
        <div class="form-group">
          <label for="meetingCode">
            <i class="fas fa-key"></i> Meeting Code
          </label>
          <div class="input-with-icon">
            <i class="fas fa-key"></i>
            <input 
              type="text" 
              id="meetingCode" 
              class="code-input"
              placeholder="e.g. f41a884e278d9141fe0ee5bdcca1490b"
              maxlength="32"
              autocomplete="off"
            />
          </div>
          <div class="code-hint">
            <i class="fas fa-lightbulb"></i>
            Enter the 32-character code from your doctor
          </div>
          <div class="error-message" id="codeError">Invalid meeting code.</div>
        </div>

        <div class="form-group">
          <label for="patientName">
            <i class="fas fa-user"></i> Your Full Name
          </label>
          <div class="input-with-icon">
            <i class="fas fa-user"></i>
            <input 
              type="text" 
              id="patientName" 
              placeholder="Enter your full name"
              required
            />
          </div>
          <div class="error-message" id="nameError">Please enter your name.</div>
        </div>
      </div>

      <div class="button-group">
        <button onclick="validateAndJoin()" class="join-btn-large">
          <i class="fas fa-sign-in-alt"></i> Join Consultation Now
        </button>
      </div>

      <div class="section-divider">
        <span>Need Help?</span>
      </div>

      <div class="button-group">
        <button onclick="location.href='consult.html'" class="back-btn">
          <i class="fas fa-arrow-left"></i> Back to Consultation Menu
        </button>
      </div>
    </div>





<script src="auth-guard.js"></script>
<script src="navbar.js"></script>



<script>
  // User logout function (only clears user sessions, not doctor sessions)
function logout() {
    if (confirm('Are you sure you want to logout?')) {
        window.location.href = 'user_logout.php';
    }
}

// FIXED: Mobile menu toggle - now uses 'show' class instead of 'active'
function toggleMobileMenu() {
    const mobileMenu = document.getElementById('mobileMenu');
    const hamburger = document.getElementById('hamburger');
    mobileMenu.classList.toggle('show');  // Changed from 'active' to 'show'
    hamburger.classList.toggle('open');   // Changed from 'active' to 'open'
}

// Close mobile menu when clicking outside
document.addEventListener('click', function(e) {
    const mobileMenu = document.getElementById('mobileMenu');
    const hamburger = document.getElementById('hamburger');
    
    if (!e.target.closest('.mobile-menu-btn') && !e.target.closest('.mobile-menu')) {
        if (mobileMenu.classList.contains('show')) {
            mobileMenu.classList.remove('show');
            hamburger.classList.remove('open');
        }
    }
});


  function validateAndJoin() {
    const codeInput = document.getElementById('meetingCode');
    const nameInput = document.getElementById('patientName');
    const codeError = document.getElementById('codeError');
    const nameError = document.getElementById('nameError');
    
    // Reset errors
    codeError.style.display = 'none';
    nameError.style.display = 'none';
    codeInput.classList.remove('invalid');
    nameInput.classList.remove('invalid');

    let isValid = true;

    // Validate name
    const name = nameInput.value.trim();
    if (!name) {
      nameError.textContent = 'Please enter your name.';
      nameError.style.display = 'block';
      nameInput.classList.add('invalid');
      isValid = false;
    } else if (name.length < 2) {
      nameError.textContent = 'Name must be at least 2 characters.';
      nameError.style.display = 'block';
      nameInput.classList.add('invalid');
      isValid = false;
    }

    // Validate code
    let meetingCode = codeInput.value.trim().replace(/\s+/g, '');
    if (!meetingCode) {
      codeError.textContent = 'Please enter a meeting code.';
      codeError.style.display = 'block';
      codeInput.classList.add('invalid');
      isValid = false;
    } else if (meetingCode.length < 10) {
      codeError.textContent = 'Meeting code must be at least 10 characters.';
      codeError.style.display = 'block';
      codeInput.classList.add('invalid');
      isValid = false;
    }

    if (!isValid) {
      console.log('âŒ Validation failed');
      return;
    }

    // Show loading
    console.log('âœ… Validation passed');
    console.log('Code:', meetingCode);
    console.log('Name:', name);
    
    document.getElementById('step1').style.display = 'none';
    document.getElementById('validating').style.display = 'flex';

    // Build join URL
    const patientName = encodeURIComponent(name);
    const joinUrl = `teleconsult_join.html?room=${meetingCode}&name=${patientName}`;
    
    console.log('ðŸš€ Redirecting to:', joinUrl);
    
    // Redirect after short delay
    setTimeout(() => {
      window.location.href = joinUrl;
    }, 500);
  }

  // Event listeners
  document.addEventListener('DOMContentLoaded', function() {
    const codeInput = document.getElementById('meetingCode');
    const nameInput = document.getElementById('patientName');
    
    // Enter key navigation
    codeInput.addEventListener('keypress', function(e) {
      if (e.key === 'Enter') {
        nameInput.focus();
      }
    });
    
    nameInput.addEventListener('keypress', function(e) {
      if (e.key === 'Enter') {
        validateAndJoin();
      }
    });

    // Auto-format code input (lowercase, no spaces)
    codeInput.addEventListener('input', function(e) {
      this.value = this.value.replace(/\s+/g, '').toLowerCase();
    });

    // Auto-capitalize name
    nameInput.addEventListener('blur', function(e) {
      const words = this.value.trim().split(' ');
      const capitalized = words.map(word => 
        word.charAt(0).toUpperCase() + word.slice(1).toLowerCase()
      ).join(' ');
      this.value = capitalized;
    });
  });
</script>



</body>
</html>
